function [Footstep ] = LowLevelPlan(CostMap, TerrainMap)
%   Low Level planning
%   plan the footsteps of the robot on a rugged terrain
%
%   Auther: Tianyu Chen

%  n
%  ----------------->y
% |      1 2 3 ... c2
% |   c2+1
% | 2*c2+1 
% |   .
% |   .
% |c1*c2+1
% *
% x

% Input : 457 by 457 terrain cost map
% Output: 3 by 6 by StepNum pages matrix

% search criterion
Config = ConfigPara_();

% 1) first generate an estimated body cost map
% TerrainCostMap: c1*c2 
%    BodyCostMap: c1-2*MarginX * c2-2*MarginY
fprintf('[Low Level Plan] Calculating body cost...\n');
[BodyCostMap] = BodyCost(CostMap, Config);  % 311 by 311 matrix
BodyCostMap = BodyCostMap - min(BodyCostMap(:));

% 2) then generate a body path that has the lowest cost
fprintf('[Low Level Plan] Searching body traj...\n');
[BodyPath] = SearchBody(BodyCostMap);  % StepNum by 2 matrix, the Body path is defined
                                       % in BodyCostMap

% 3) discretize the body path
fprintf('[Low Level Plan] Discretizing body path...\n');
[NewBodyPath] = DiscreteBodyPath(BodyPath, BodyCostMap);

% 4) generate footstep plan
fprintf('[Low Level Plan] Generating footstep plan...\n');
[Footstep] = GenerateFootstep(NewBodyPath, CostMap, TerrainMap, Config); % 3 by 6 by StepNum pages matrix

end

